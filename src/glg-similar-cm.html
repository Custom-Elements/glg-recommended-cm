<link rel="import" href="../node_modules/glg-nectar/build/glg-nectar.html" />
<link rel="import" href="../node_modules/ui-typeahead/build/ui-typeahead.html" />
<link rel="import" href="../node_modules/ui-tooltip/build/ui-tooltip.html" />
<link rel="import" href="../node_modules/ui-progress/build/ui-progress.html" />
<link rel="import" href="../lib/core-ajax.html" />
<link rel="import" href="../lib/polymer-jsonp.html" />
<polymer-element name="glg-similar-cm" attributes="limit resultset cmlist cmid createdby" >
<template>
<link rel="stylesheet" href="./glg-similar-cm.less"/>
<ui-progress id="loading"></ui-progress>
<section>
  <glg-nectar
  id="nectar"
  urls='wss://nectar.glgroup.com/ws'
  entities='["cm", "cm-localized"]'
  trigger="inputChange"
  limit="{{limit}}"
  resultset="{{resultset}}"
  >
  <core-ajax
  id ="getcms"
  response={{cmlist}}
  handleAs="json">
  <div id="similarcms">
    <ul>
      <template repeat="{{ item in cmlist }}">
      <li>
        <a href="https://advisors.glgroup.com/cm/{{item.RELATED_CM_ID}}">
          {{item.FIRST_NAME}} {{item.MIDDLE_INITIAL}} {{item.LAST_NAME}}
        </a>
        {{item.TITLE}} ({{item.COMPANY}})
      <ui-tooltip>
      <a id="{{item.RELATED_CM_ID}}" class="delete fa fa-times" on-click="{{removerel}}" style="{{admin}}"></a>
      <div tip>
        Delete this relationship.
      </div>
      </ui-tooltip>
      </li>
      </template>
    </ul>
  </div>
  </core-ajax>
  <ui-typeahead
  on-change="{{addrel}}"
  style="{{admin}}"
  id="typeahead"
  icon="fa-search"
  placeholder="Search for Council Members">
  <template id="results" repeat="{{resultset}}">
  <template repeat="{{results}}">
  <ui-typeahead-item id={{id}}>
  <i class="fa fa-user {{type}}"></i>
  <strong>{{name}}</strong>
  <span>{{title}}</span>
  </ui-typeahead-item>
  </template>

  </ui-typeahead>
  </glg-nectar>
  <core-ajax id="addcm"
  on-core-response="{{refresh}}"
  on-core-error="{{handleerr}}"
  handleAs="json">
  </core-ajax>
  <core-ajax id="removecm"
  on-core-response="{{refresh}}"
  on-core-error="{{handleerr}}"
  handleAs="json">
  </core-ajax>
  <polymer-jsonp id="betalist"
  on-polymer-response="{{getbetagroup}}">
  </polymer-jsonp>
</section>
</template>
<script src="./glg-similar-cm.litcoffee"></script>
</polymer-element>
